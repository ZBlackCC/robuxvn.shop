<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>ROBUXVN.SHOP - RÚT ROBUX GIÁ RẺ</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@500;700&family=Orbitron:wght@900&display=swap" rel="stylesheet">
<style>
  :root{--bg:#f0f2f5;--card:#fff;--text:#000;--accent:#00d4aa;--gold:#f1c40f;--border:#00d4aa;}
  *{margin:0;padding:0;box-sizing:border-box}
  body{background:var(--bg);color:var(--text);font-family:'Roboto',sans-serif;min-height:100vh;}
  .header{background:linear-gradient(135deg,#00d4aa,#00a085);padding:30px;text-align:center;box-shadow:0 8px 30px rgba(0,212,170,0.4);}
  .header h1{font-family:'Orbitron',sans-serif;font-size:4.5rem;color:#fff;text-shadow:0 0 20px #000,4px 4px var(--gold);}

  .nav{display:flex;justify-content:center;flex-wrap:nowrap;overflow-x:auto;gap:8px;padding:15px;background:#fff;position:sticky;top:0;z-index:99;box-shadow:0 4px 20px rgba(0,0,0,0.1);}
  .nav button{white-space:nowrap;background:#fff;color:#000;padding:12px 20px;border:2px solid transparent;border-radius:12px;font-weight:700;cursor:pointer;transition:.3s;min-width:110px;}
  .nav button:hover,.nav button.active{background:var(--accent);color:#fff;box-shadow:0 0 20px rgba(0,212,170,0.5);}

  .container{max-width:700px;margin:30px auto;background:var(--card);padding:30px;border-radius:20px;border:3px solid var(--border);box-shadow:0 15px 50px rgba(0,212,170,0.25);}
  h2{color:var(--accent);text-align:center;margin-bottom:25px;font-size:2.3rem;}
  .tab{display:none}.tab.active{display:block}

  input,button{width:100%;padding:16px;margin:12px 0;border:none;border-radius:12px;font-size:17px;}
  input{background:#f5f5f5;color:#000;border:2px solid #ddd;}
  button{background:linear-gradient(45deg,var(--accent),#00b894);color:#fff;font-weight:700;cursor:pointer;}
  button:hover{transform:translateY(-4px);box-shadow:0 15px 35px rgba(0,212,170,0.7);}

  #robuxPreview{font-size:32px;color:var(--gold);font-weight:bold;text-align:center;margin:20px 0;}
  .qr{max-width:300px;margin:30px auto;display:block;border:6px solid var(--accent);border-radius:18px;}
  .hidden{display:none}
</style>
</head>
<body>

<div class="header"><h1>ROBUXVN.SHOP</h1></div>

<!-- Login / Register -->
<div id="loginPage" class="container" style="max-width:500px;margin-top:100px">
  <h2 style="color:var(--accent)">ĐĂNG NHẬP / ĐĂNG KÝ</h2>
  <input type="text" id="username" placeholder="Username">
  <input type="password" id="password" placeholder="Mật khẩu">
  <button onclick="login()">ĐĂNG NHẬP</button>
  <button onclick="register()" style="background:#f1c40f;color:#000">ĐĂNG KÝ MIỄN PHÍ</button>
</div>

<!-- Main App (ẩn lúc đầu) -->
<div id="app" class="hidden">
  <div class="nav">
    <button onclick="openTab('home')" class="active">TRANG CHỦ</button>
    <button onclick="openTab('nap')">NẠP ROBUX</button>
    <button onclick="openTab('rut')">RÚT ROBUX</button>
    <button onclick="openTab('vongquay')">VÒNG QUAY</button>
    <button onclick="openTab('giftcode')">GIFTCODE</button>
    <button onclick="openTab('danhgia')">ĐÁNH GIÁ</button>
    <button onclick="logout()" style="background:#e74c3c">ĐĂNG XUẤT</button>
  </div>

  <div class="container">

    <div id="home" class="tab active">
      <h2>Xin chào <span id="name">bạn</span>!</h2>
      <p style="text-align:center;font-size:28px;margin:30px 0">
        Số dư: <b id="bal" style="color:var(--gold)">0</b> Robux
      </p>
      <div style="text-align:center"><button onclick="openTab('nap')" style="padding:20px 60px;font-size:22px">NẠP ROBUX NGAY</button></div>
    </div>

    <div id="nap" class="tab">
      <h2>NẠP ROBUX (10k = 65R)</h2>
      <input type="number" id="amount" placeholder="Nhập số tiền (VD: 100000)" oninput="calcRobux()">
      <div id="robuxPreview">0 Robux</div>
      <button onclick="createQR()">TẠO MÃ QR</button>
      <div id="qrDiv"></div>
    </div>

    <div id="rut" class="tab">
      <h2>RÚT ROBUX</h2>
      <input type="text" id="rbxUser" placeholder="Username Roblox">
      <input type="number" id="rbxAmt" placeholder="Số Robux muốn rút">
      <button onclick="sendRut()">GỬI YÊU CẦU</button>
      <p id="rutMsg"></p>
    </div>

    <div id="vongquay" class="tab">
      <h2>VÒNG QUAY MAY MẮN – 30 Robux/lần</h2>
      <div style="text-align:center;margin:30px 0">
        <canvas id="wheel" width="340" height="340"></canvas>
        <div style="font-size:2.5rem;color:var(--gold);margin:20px 0" id="prizeText">Nhấn QUAY để thử vận may!</div>
        <button onclick="spin()" style="padding:18px 60px;font-size:20px">QUAY NGAY – 30 Robux</button>
      </div>
    </div>

    <div id="giftcode" class="tab">
      <h2>NHẬP GIFTCODE</h2>
      <input type="text" id="giftInput" placeholder="Nhập mã giftcode">
      <button onclick="useGift()">SỬ DỤNG</button>
      <p id="giftMsg"></p>
    </div>

    <div id="danhgia" class="tab">
      <h2>ĐÁNH GIÁ 5★</h2>
      <div id="reviews"></div>
    </div>

  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
let currentUser = null;

// Login / Register
async function login(){
  const u = document.getElementById("username").value.trim();
  const p = document.getElementById("password").value;
  if(!u||!p) return alert("Nhập đầy đủ");
  const res = await axios.post("/login",{username:u,password:p}).catch(()=>[{data:{success:false,msg:"Lỗi server"}}]);
  if(res.data.success){
    currentUser = res.data.user;
    document.getElementById("loginPage").classList.add("hidden");
    document.getElementById("app").classList.remove("hidden");
    document.getElementById("name").innerText = u;
    document.getElementById("bal").innerText = res.data.user.balance.toLocaleString();
  }else alert(res.data.msg || "Sai tài khoản hoặc mật khẩu");
}
async function register(){
  const u = document.getElementById("username").value.trim();
  const p = document.getElementById("password").value;
  if(!u||!p) return alert("Nhập đầy đủ");
  const res = await axios.post("/register",{username:u,password:p});
  alert(res.data.msg);
}
function logout(){
  location.reload();
}

// Tab
function openTab(t){
  document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
  document.querySelectorAll('.nav button').forEach(x=>x.classList.remove('active'));
  document.getElementById(t).classList.add('active');
  document.querySelector(`button[onclick="openTab('${t}')"]`).classList.add('active');
}

// Nạp tiền
function calcRobux(){
  const money = parseInt(document.getElementById("amount").value)||0;
  const robux = Math.floor(money/10000*65);
  document.getElementById("robuxPreview").innerHTML = `<b>${robux.toLocaleString()}</b> Robux`;
}
async function createQR(){
  const a = document.getElementById("amount").value;
  if(a<50000) return alert("Tối thiểu 50k");
  const r = await axios.post("/qr",{amount:Number(a),user:currentUser.username});
  document.getElementById("qrDiv").innerHTML = `<p style="text-align:center">Nạp <b>${(a/10000*65).toLocaleString()} Robux</b></p>
    <img class="qr" src="${r.data.qr}">
    <p style="text-align:center;word-break:break-all"><b>Nội dung:</b> ${r.data.desc}</p>`;
}

// Vòng quay (6 phần bằng nhau, tỉ lệ thật hiếm)
const prizes = ["5 Robux","10 Robux","30 Robux","50 Robux","200 Robux","500 Robux"];
const weights = [300,250,200,150,5,1]; // 200 & 500 cực hiếm
let spinning = false;
function drawWheel(){
  const c = document.getElementById("wheel");
  const ctx = c.getContext("2d");
  const colors = ["#95a5a6","#7289da","#2ecc71","#3498db","#e74c3c","#f1c40f"];
  prizes.forEach((p,i)=>{
    ctx.fillStyle = colors[i];
    ctx.beginPath();
    ctx.moveTo(170,170);
    ctx.arc(170,170,170,i*60*Math.PI/180,(i+1)*60*Math.PI/180);
    ctx.fill();
    ctx.save();
    ctx.translate(170,170);
    ctx.rotate((i+0.5)*60*Math.PI/180);
    ctx.fillStyle = "#fff";
    ctx.font = "bold 20px Roboto";
    ctx.fillText(p, 90, 10);
    ctx.restore();
  });
}
drawWheel();

function spin(){
  if(spinning) return;
  if((currentUser?.balance||0) < 30) return alert("Không đủ Robux (cần 30R)");
  spinning = true;
  const total = weights.reduce((a,b)=>a+b,0);
  let roll = Math.random()*total;
  let winIndex = 0;
  for(let i=0;i<weights.length;i++){
    roll -= weights[i];
    if(roll <= 0){winIndex = i; break;}
  }
  const deg = winIndex*60 + 1800 + Math.random()*60;
  document.getElementById("wheel").style.transition = "5s";
  document.getElementById("wheel").style.transform = `rotate(${deg}deg)`;
  setTimeout(()=>{
    document.getElementById("prizeText").innerHTML = `CHÚC MỪNG!<br><b style="font-size:3rem;color:${["#95a5a6","#7289da","#2ecc71","#3498db","#e74c3c","#f1c40f"][winIndex]}">${prizes[winIndex]}</b>`;
    spinning = false;
  },5200);
}

// Giftcode + đánh giá
function useGift(){
  const c = document.getElementById("giftInput").value.trim().toUpperCase();
  if(c==="NOEL2025") alert("Nhận 500 Robux thành công!");
  else alert("Mã không đúng");
}
const fakeReviews = ["Rút siêu nhanh","Giá rẻ nhất VN","Trúng 200R từ vòng quay","Admin donate đúng user","Shop đẹp như Roblox","Nạp 1 triệu được đúng 6500R"];
function genReviews(){
  const d = document.getElementById("reviews");
  fakeReviews.sort(()=>Math.random()-0.5).forEach(t=>{
    d.innerHTML += `<div style="background:#f9f9f9;padding:20px;margin:15px 0;border-radius:15px;border-left:5px solid var(--gold)">
      <div style="color:var(--gold);font-size:1.5rem">★★★★★</div><p><b>Khách hàng</b>: ${t}</p></div>`;
  });
}
genReviews();
</script>
</body>
</html>

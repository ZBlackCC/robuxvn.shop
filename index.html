<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>ROBUXVN.SHOP - R√öT ROBUX GI√Å R·∫∫ NH·∫§T 2025</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@500;700&family=Orbitron:wght@900&display=swap" rel="stylesheet">
<style>
  :root{
    --accent:#00d4aa;
    --gold:#f1c40f;
    --border:#00d4aa;
  }
  *{margin:0;padding:0;box-sizing:border-box}
  body{
    background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
    font-family:'Roboto',sans-serif;
    min-height:100vh;
    overflow-x:hidden;
  }

  /* TUY·∫æT R∆†I */
  .snow{
    position:fixed;top:-10px;width:8px;height:8px;
    background:#fff;border-radius:50%;pointer-events:none;
    box-shadow:0 0 12px #fff;opacity:0.8;z-index:9999;
    animation:snowfall linear infinite;
  }
  @keyframes snowfall{to{transform:translateY(100vh) rotate(360deg);}}

  /* HEADER */
  .header{
    background:linear-gradient(135deg,#00d4aa,#00a085);
    padding:24px 10px;text-align:center;
    box-shadow:0 10px 40px rgba(0,212,170,0.5);
  }
  .header h1{
    font-family:'Orbitron',sans-serif;
    font-size:clamp(1.8rem, 7vw, 3.4rem);
    color:#fff;
    text-shadow:0 0 18px #000, 3px 3px 0 var(--gold);
    letter-spacing:2px;
    line-height:1.2;
    word-break:break-word;
  }
  .header p{
    color:#fff;
    font-size:clamp(1.1rem, 4vw, 1.5rem);
    margin-top:8px;
    font-weight:900;
    text-shadow:0 0 12px #000;
  }

  /* LOGIN */
  #loginPage{
    position:fixed;inset:0;background:rgba(0,0,0,0.96);z-index:99999;
    display:flex;align-items:center;justify-content:center;padding:15px;
  }
  .login-box{
    background:#fff;padding:35px 30px;border-radius:25px;
    width:100%;max-width:370px;box-shadow:0 20px 60px rgba(0,212,170,0.7);
    border:5px solid var(--accent);text-align:center;
  }

  /* NAV + CONTAINER */
  .nav{
    display:flex;justify-content:center;flex-wrap:nowrap;overflow-x:auto;
    gap:6px;padding:10px 8px;background:#fff;position:sticky;top:0;z-index:99;
    box-shadow:0 5px 20px rgba(0,0,0,0.15);scrollbar-width:none;
    border-bottom:3px solid var(--accent);
  }
  .nav::-webkit-scrollbar{display:none}
  .nav button{
    white-space:nowrap;background:#fff;color:#000;padding:10px 14px;
    border-radius:18px;font-weight:700;font-size:13px;min-width:95px;
    transition:.25s;border:2px solid #eee;flex-shrink:0;
    overflow:hidden;text-overflow:ellipsis;
  }
  .nav button:hover,.nav button.active{
    background:var(--accent);color:#fff;
    transform:translateY(-3px);box-shadow:0 10px 25px rgba(0,212,170,0.5);
  }

  .container{
    max-width:760px;margin:18px auto;background:#fff;
    padding:24px;border-radius:25px;
    border:5px solid var(--border);
    box-shadow:0 18px 55px rgba(0,212,170,0.32);
    overflow:hidden;
  }

  h2{color:var(--accent);text-align:center;margin-bottom:20px;
     font-size:clamp(1.8rem,5vw,2.5rem);}

  input,button,select{
    width:100%;padding:15px;margin:10px 0;
    border-radius:14px;font-size:16.5px;font-weight:600;
  }
  input,select{background:#f8f9fa;border:3px solid #ddd;}
  input:focus,select:focus{outline:none;border-color:var(--accent);box-shadow:0 0 18px rgba(0,212,170,0.4);}
  button{
    background:linear-gradient(45deg,var(--accent),#00b894);
    color:#fff;border:none;cursor:pointer;
    box-shadow:0 8px 25px rgba(0,212,170,0.4);
  }
  button:hover{transform:translateY(-5px);box-shadow:0 16px 35px rgba(0,212,170,0.6);}

  .packages{
    display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin:20px 0;
  }
  .pkg{
    background:#f0f2f5;padding:16px;border-radius:14px;text-align:center;
    cursor:pointer;font-weight:bold;font-size:15px;
    border:2.5px solid #ddd;transition:.3s;
  }
  .pkg:hover,.pkg.selected{
    background:var(--accent);color:#fff;border-color:var(--accent);
    transform:scale(1.06);
  }

  #robuxPreview{
    font-size:clamp(27px,7vw,37px);color:var(--gold);
    text-align:center;margin:22px 0;font-weight:bold;
    text-shadow:0 0 18px var(--gold);
  }

  .tab{display:none}.tab.active{display:block}
  .hidden{display:none}

  .gd-item{
    padding:10px;background:#fff;margin:6px 0;border-radius:10px;border-left:5px solid var(--accent);
  }

  @media (max-width:480px){
    .container{padding:18px;margin:12px 8px;}
    .packages{grid-template-columns:repeat(3,1fr);gap:10px;}
    .pkg{font-size:14px;padding:14px 6px;}
  }

  /* POPUP ƒê·∫∏P */
  #popup{
    position:fixed; inset:0;
    background:rgba(0,0,0,0.7);
    display:none; justify-content:center; align-items:center;
    z-index:999999;
  }
  #popupBox{
    background:#fff; padding:25px; border-radius:18px;
    width:90%; max-width:360px; text-align:center;
    animation:pop .35s ease;
  }
  @keyframes pop {from{transform:scale(.6); opacity:0} to{transform:scale(1); opacity:1}}

  /* small helper for history boxes */
  .hist-box{
    padding:14px;margin:10px 0;border-radius:12px;background:#fafafa;border-left:6px solid var(--accent);
  }
  .hist-box.rut{border-left-color:#e74c3c;}
</style>
</head>
<body>

<div id="snowZone"></div>

<!-- LOGIN -->
<div id="loginPage">
  <div class="login-box">
    <h2>ROBUXVN.SHOP</h2>
    <input type="text" id="username" placeholder="Username">
    <input type="password" id="password" placeholder="M·∫≠t kh·∫©u">
    <button onclick="login()">ƒêƒÇNG NH·∫¨P</button>
    <button onclick="register()" style="background:#f1c40f;color:#000">ƒêƒÇNG K√ù NGAY</button>
  </div>
</div>

<!-- HEADER ƒê√É CH·ªàNH -->
<div class="header">
  <h1>ROBUXVN.SHOP</h1>
  <p>SHOP ROBUX R·∫∫ NH·∫§T 2025</p>
</div>

<div class="nav">
  <button onclick="openTab('home')" class="active">TRANG CH·ª¶</button>
  <button onclick="openTab('nap')">N·∫†P ROBUX</button>
  <button onclick="openTab('rut')">R√öT ROBUX</button>
  <button onclick="openTab('vongquay')">V√íNG QUAY</button>
  <button onclick="openTab('giftcode')">GIFTCODE</button>
  <button onclick="openTab('danhgia')">ƒê√ÅNH GI√Å</button>
  <button onclick="logout()" style="background:#e74c3c">ƒêƒÇNG XU·∫§T</button>
</div>

<div class="container">
  <!-- HOME -->
  <div id="home" class="tab active">
    <h2>Xin ch√†o <span id="name">b·∫°n</span>!</h2>
    <p style="text-align:center;font-size:31px;margin:35px 0">
      S·ªë d∆∞: <b id="bal" style="color:var(--gold)">0</b> Robux
    </p>
    <div style="text-align:center">
      <button onclick="openTab('nap')" style="padding:20px 70px;font-size:23px">N·∫†P ROBUX NGAY</button>
    </div>

    <!-- GIAO D·ªäCH G·∫¶N ƒê√ÇY (auto scroll + mix th·∫≠t/·∫£o) -->
    <div style="margin-top:32px">
      <h2 style="font-size:22px;margin-bottom:12px;text-align:left">Giao d·ªãch g·∫ßn ƒë√¢y</h2>
      <div id="gdList" style="height:210px; overflow:hidden; border:3px solid var(--accent); border-radius:14px; background:#f9f9f9; padding:10px"></div>
    </div>
  </div>

  <!-- N·∫†P ROBUX -->
  <div id="nap" class="tab">
    <h2>N·∫†P ROBUX</h2>
    <p style="text-align:center;color:#555;margin-bottom:15px">10.000ƒë = 65 Robux</p>

    <select id="napMethod" onchange="toggleNap()">
      <option value="qr">QR NG√ÇN H√ÄNG (T·ª∞ ƒê·ªòNG)</option>
      <option value="thecao">N·∫†P TH·∫∫ C√ÄO</option>
    </select>

    <div id="qrBox">
      <input type="number" id="qrAmount" placeholder="Nh·∫≠p s·ªë ti·ªÅn (VD: 100000)" oninput="calcQR()">
      <div id="qrPreview">0 Robux</div>
      <div class="packages">
        <div class="pkg" onclick="setQR(50000)">50K</div>
        <div class="pkg" onclick="setQR(100000)">100K</div>
        <div class="pkg" onclick="setQR(200000)">200K</div>
        <div class="pkg" onclick="setQR(500000)">500K</div>
      </div>
      <button onclick="createQR()">N·∫†P NGAY</button>
    </div>

    <div id="cardBox" class="hidden">
      <p style="text-align:center;font-weight:bold;margin:15px 0">Ch·ªçn m·ªánh gi√°:</p>
      <div class="packages">
        <div class="pkg" onclick="chooseCard(10000)">10K</div>
        <div class="pkg" onclick="chooseCard(20000)">20K</div>
        <div class="pkg" onclick="chooseCard(50000)">50K</div>
        <div class="pkg" onclick="chooseCard(100000)">100K</div>
        <div class="pkg" onclick="chooseCard(200000)">200K</div>
        <div class="pkg" onclick="chooseCard(500000)">500K</div>
      </div>
      <select id="cardType">
        <option>Viettel</option><option>Vinaphone</option><option>Mobifone</option><option>Zing</option><option>Gate</option>
      </select>
      <input type="text" id="seri" placeholder="S·ªë seri">
      <input type="text" id="code" placeholder="M√£ th·∫ª">
      <button onclick="sendCard()">N·∫†P NGAY</button>
    </div>

    <!-- L·ªäCH S·ª¨ N·∫†P ROBUX -->
    <h2 style="margin-top:18px;font-size:20px;text-align:left">L·ªãch s·ª≠ n·∫°p</h2>
    <div id="lsNapBox"></div>
  </div>

  <!-- R√öT -->
  <div id="rut" class="tab">
    <h2>R√öT ROBUX</h2>
    <input type="text" placeholder="Username Roblox" id="rbxUser">
    <input type="number" placeholder="S·ªë Robux mu·ªën r√∫t" id="rbxAmt">
    <button id="rutBtn">G·ª¨I Y√äU C·∫¶U</button>

    <!-- L·ªäCH S·ª¨ R√öT ROBUX -->
    <h2 style="margin-top:18px;font-size:20px;text-align:left">L·ªãch s·ª≠ r√∫t</h2>
    <div id="lsRutBox"></div>
  </div>

  <!-- V√íNG QUAY -->
  <div id="vongquay" class="tab">
    <h2>V√íNG QUAY MAY M·∫ÆN</h2>
    <p style="text-align:center;font-size:23px;margin-bottom:20px">
      Gi√° quay: <b style="color:var(--gold)">30 Robux</b>/l·∫ßn
    </p>
    <div style="text-align:center">
      <canvas id="wheel" width="330" height="330"></canvas>
      <div class="prize" id="prizeText">Nh·∫•n QUAY ƒë·ªÉ th·ª≠ v·∫≠n may!</div>
      <button onclick="spin()" style="margin-top:20px;padding:18px 60px;font-size:20px">QUAY NGAY</button>
    </div>
  </div>

  <div id="giftcode" class="tab">
    <h2>NH·∫¨P GIFTCODE</h2>
    <input type="text" id="giftInput" placeholder="Nh·∫≠p m√£ giftcode">
    <button onclick="useGift()">S·ª¨ D·ª§NG</button>
  </div>

  <div id="danhgia" class="tab">
    <h2>ƒê√ÅNH GI√Å 5‚òÖ</h2>
    <div id="reviews"></div>
  </div>
</div>

<!-- POPUP ƒê·∫∏P -->
<div id="popup">
  <div id="popupBox">
    <h3 style="font-size:22px;color:#00d4aa;margin-bottom:10px">TH√îNG B√ÅO</h3>
    <p id="popupText" style="font-size:16px; line-height:1.6; margin-bottom:20px"></p>
    <button onclick="closePopup()"
      style="background:#00d4aa;color:#fff;padding:12px 25px;border:none;border-radius:12px;font-weight:bold">
      ƒê√≥ng
    </button>
  </div>
</div>

<script>
// KH·ªûI T·∫†O BI·∫æN CHUNG
let currentUser = { username: "guest", balance: 0 };
let cardAmount = 0;

// resetTimeout (n·∫øu code c≈© g·ªçi) ‚Äî th√™m 1 h√†m r·ªóng an to√†n
function resetTimeout(){ /* placeholder n·∫øu c·∫ßn */ }

/* ---------- POPUP ƒê·∫∏P ---------- */
function showPopup(text){
  document.getElementById("popupText").innerHTML = text;
  document.getElementById("popup").style.display="flex";
}
function closePopup(){document.getElementById("popup").style.display="none";}

/* ---------- LOGIN (TH√äM KI·ªÇM TRA 6 K√ù T·ª∞ + POPUP ƒê·∫∏P) ---------- */
function login(){
  const u = document.getElementById("username").value.trim();
  const p = document.getElementById("password").value;

  if(u.length < 6) return alert("Username ph·∫£i √≠t nh·∫•t 6 k√Ω t·ª±!");
  if(p.length < 6) return alert("M·∫≠t kh·∫©u ph·∫£i √≠t nh·∫•t 6 k√Ω t·ª±!");

  if(!u || !p) return alert("Nh·∫≠p ƒë·∫ßy ƒë·ªß username v√† m·∫≠t kh·∫©u bro!");
  
  currentUser = {username:u, balance:0};
  document.getElementById("loginPage").style.display="none";
  document.getElementById("name").innerText = u;
  document.getElementById("bal").innerText = "0";
  
  alert("ƒêƒÉng nh·∫≠p th√†nh c√¥ng! Ch√†o " + u + "!");

  setTimeout(() => {
    showPopup(
      `‚è≥ <b>TH·ªúI GIAN DUY·ªÜT ƒê∆†N</b>: 1 - 3 ng√†y<br><br>` +
      `‚ùå Kh√¥ng nh·∫≠n th·∫ª VietnamMobile<br>` +
      `üí≥ H·ªó tr·ª£ th·∫ª c√†o / chuy·ªÉn kho·∫£n / auto<br><br>` +
      `C√≥ v·∫•n ƒë·ªÅ x·∫£y ra ho·∫∑c th·∫Øc m·∫Øc ? Li√™n h·ªá Shop nh√©<br><br>` +
      `"robux r·∫ª qu√°? Scam h·∫£?" C√°c b·∫°n c√≥ th·ªÉ n·∫°p t·ªëi thi·ªÉu 10k v√†o ƒë·ªÉ th·ª≠ xem nh√©!`
    );
  }, 600);

  resetTimeout();
  // update history displays in case user had stored items under same username
  updateNapLS();
  updateRutLS();
}

/* ---------- QR AUTO MB BANK ---------- */
function calcQR(){
  const m = parseInt(document.getElementById("qrAmount").value)||0;
  const r = Math.floor(m/10000*65);
  document.getElementById("qrPreview").innerHTML = `<b>${r.toLocaleString()}</b> Robux`;
}
function setQR(x){document.getElementById("qrAmount").value=x;calcQR();}

function createQR(){
  const amount = parseInt(document.getElementById("qrAmount").value);
  if(!amount || amount < 10000) return alert("T·ªëi thi·ªÉu 10.000ƒë nha bro!");

  const user = currentUser.username ? currentUser.username.toUpperCase() : "GUEST";
  const noiDung = `ROBUXVN-${user}-${amount}`;

  const qrUrl = 
    `https://img.vietqr.io/image/mbbank-0939546882-compact.png?amount=${amount}&addInfo=${encodeURIComponent(noiDung)}&accountName=ROBUXVN%20SHOP`;

  showPopup(`
    <b>Qu√©t QR ƒë·ªÉ chuy·ªÉn kho·∫£n</b><br><br>
    <img src="${qrUrl}" style="width:230px;border-radius:12px;box-shadow:0 0 15px rgba(0,0,0,0.4)"><br><br>
    <b>STK:</b> 0939546882 (MB Bank)<br>
    <b>N·ªôi dung CK:</b><br>
    <span style="color:#00d4aa">${noiDung}</span><br><br>
    Sau khi chuy·ªÉn kho·∫£n, Robux s·∫Ω c·ªông ngay!
  `);

  // L∆∞u l·ªãch s·ª≠ n·∫°p ngay (gi·∫£ l·∫≠p "th·ª±c" v√¨ user qu√©t m√£)
  const rb = Math.floor(amount/10000*65);
  pushNap({
    user: currentUser.username || "guest",
    amount: amount,
    robux: rb,
    time: new Date().toLocaleString()
  });

  // update transaction feed & nap history
  addTransactionDisplay(`${currentUser.username || "guest"} v·ª´a n·∫°p ${amount.toLocaleString()}ƒë (${rb} Robux)`);
  updateNapLS();
}

/* ---------- N·∫†P TH·∫∫ C√ÄO ---------- */
function chooseCard(amount){
  cardAmount = amount;
  document.querySelectorAll("#cardBox .pkg").forEach(p=>p.classList.remove('selected'));
  event.target.classList.add("selected");
}
function sendCard(){
  if(cardAmount===0) return alert("Ch·ªçn m·ªánh gi√° tr∆∞·ªõc ƒë√£ bro!");
  const seri = document.getElementById("seri").value.trim();
  const code = document.getElementById("code").value.trim();
  if(!seri || !code) return alert("Nh·∫≠p ƒë·∫ßy ƒë·ªß seri + m√£ th·∫ª!");
  alert(`Th·∫ª ${cardAmount.toLocaleString()}ƒë ƒë√£ g·ª≠i!\nAdmin duy·ªát 1-3 ph√∫t nha!`);
  // L∆∞u l·ªãch s·ª≠ n·∫°p t·∫°m (s·∫Ω ƒë∆∞·ª£c duy·ªát sau) ‚Äî ghi lu√¥n nh∆∞ "ƒë√£ g·ª≠i"
  const rb = Math.floor(cardAmount/10000*65);
  pushNap({
    user: currentUser.username || "guest",
    amount: cardAmount,
    robux: rb,
    time: new Date().toLocaleString(),
    note: "N·∫°p th·∫ª g·ª≠i"
  });
  addTransactionDisplay(`${currentUser.username || "guest"} g·ª≠i th·∫ª ${cardAmount.toLocaleString()}ƒë (ch·ªù duy·ªát)`);
  document.getElementById("seri").value = "";
  document.getElementById("code").value = "";
  cardAmount = 0;
  document.querySelectorAll("#cardBox .pkg").forEach(p=>p.classList.remove("selected"));
  updateNapLS();
}

/* ---------- GIFTCODE ---------- */
function useGift(){
  const c = document.getElementById("giftInput").value.trim().toUpperCase();
  if(["NOEL2025","ROBUXVN","FREE500"].includes(c)){
    alert("NH·∫¨N 500 ROBUX TH√ÄNH C√îNG!");
    // l∆∞u l·ªãch s·ª≠ n·∫°p cho gift
    pushNap({
      user: currentUser.username || "guest",
      amount: 0,
      robux: 500,
      time: new Date().toLocaleString(),
      note: `Giftcode ${c}`
    });
    addTransactionDisplay(`${currentUser.username || "guest"} s·ª≠ d·ª•ng giftcode ${c} nh·∫≠n 500 Robux`);
    updateNapLS();
  }else alert("M√£ giftcode sai r·ªìi bro!");
}

/* ---------- V√íNG QUAY + C√ÅC H√ÄM C≈® ---------- */
const prizes = ["5","10","30","50","200","500 Robux"];
const colors = ["#95a5a6","#7289da","#2ecc71","#3498db","#e74c3c","#f1c40f"];
function drawWheel(){
  const ctx = document.getElementById("wheel").getContext("2d");
  prizes.forEach((p,i)=>{
    ctx.fillStyle = colors[i];
    ctx.beginPath();
    ctx.moveTo(165,165);
    ctx.arc(165,165,165,i*60*Math.PI/180,(i+1)*60*Math.PI/180);
    ctx.fill();
    ctx.save();ctx.translate(165,165);ctx.rotate((i+0.5)*60*Math.PI/180);
    ctx.fillStyle="#fff";ctx.font="bold 19px Roboto";ctx.fillText(p,70,8);ctx.restore();
  });
}
drawWheel();
let spinning = false;
function spin(){
  if(spinning) return; spinning=true;
  document.getElementById("wheel").style.transform = `rotate(${3600 + Math.random()*360}deg)`;
  setTimeout(()=>{
    const win = prizes[Math.floor(Math.random()*prizes.length)];
    document.getElementById("prizeText").innerHTML = `CH√öC M·ª™NG!<br><b style="font-size:4rem">${win}</b>`;
    alert("Tr√∫ng " + win + "!");
    // tr∆∞·ªùng h·ª£p tr√∫ng lo·∫°i c√≥ Robux (ch·ª©a ch·ªØ Robux) -> tr·ª´ ch·ªØ v√† l∆∞u
    const winNum = parseInt(win);
    if(!isNaN(winNum)){
      pushNap({
        user: currentUser.username || "guest",
        amount: 0,
        robux: winNum,
        time: new Date().toLocaleString(),
        note: "V√≤ng quay"
      });
      addTransactionDisplay(`${currentUser.username || "guest"} tr√∫ng v√≤ng quay ${winNum} Robux`);
      updateNapLS();
    }
    spinning=false;
  },6000);
}

/* ---------- CODE C≈® GI·ªÆ NGUY√äN ---------- */
function register(){alert("ƒêƒÉng k√Ω th√†nh c√¥ng! Gi·ªù ƒëƒÉng nh·∫≠p ƒëi bro!");}
function logout(){if(confirm("ƒêƒÉng xu·∫•t ngay h·∫£ bro?")) location.reload();}
function openTab(id){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.nav button').forEach(b=>b.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  const btn = Array.from(document.querySelectorAll('.nav button')).find(b => b.getAttribute('onclick') && b.getAttribute('onclick').includes(`openTab('${id}')`));
  if(btn) btn.classList.add('active');
  resetTimeout();
}
function calcQR(){
  const m = parseInt(document.getElementById("qrAmount").value)||0;
  const r = Math.floor(m/10000*65);
  document.getElementById("qrPreview").innerHTML = `<b>${r.toLocaleString()}</b> Robux`;
}
function setQR(x){document.getElementById("qrAmount").value=x;calcQR();}
function toggleNap(){
  const v = document.getElementById("napMethod").value;
  document.getElementById("qrBox").classList.toggle("hidden", v==="thecao");
  document.getElementById("cardBox").classList.toggle("hidden", v!=="thecao");
}
function chooseCard(amount){
  cardAmount = amount;
  document.querySelectorAll("#cardBox .pkg").forEach(p=>p.classList.remove("selected"));
  event.target.classList.add("selected");
}
function sendCard(){
  if(cardAmount===0) return alert("Ch·ªçn m·ªánh gi√° tr∆∞·ªõc ƒë√£ bro!");
  const seri = document.getElementById("seri").value.trim();
  const code = document.getElementById("code").value.trim();
  if(!seri || !code) return alert("Nh·∫≠p ƒë·∫ßy ƒë·ªß seri + m√£ th·∫ª!");
  alert(`Th·∫ª ${cardAmount.toLocaleString()}ƒë ƒë√£ g·ª≠i!\nAdmin duy·ªát 1-3 ph√∫t nha!`);
  document.getElementById("seri").value = "";
  document.getElementById("code").value = "";
  cardAmount = 0;
  document.querySelectorAll("#cardBox .pkg").forEach(p=>p.classList.remove("selected"));
}

function useGift_old(){
  const c = document.getElementById("giftInput").value.trim().toUpperCase();
  if(["NOEL2025","ROBUXVN","FREE500"].includes(c)){
    alert("NH·∫¨N 500 ROBUX TH√ÄNH C√îNG!");
  }else alert("M√£ giftcode sai r·ªìi bro!");
}

/* ---------- TRANSACTION FEED + L·ªäCH S·ª¨ (localStorage) ---------- */

let lsNap = JSON.parse(localStorage.getItem("lsNap") || "[]");
let lsRut = JSON.parse(localStorage.getItem("lsRut") || "[]");

function pushNap(obj){
  lsNap.push(obj);
  localStorage.setItem("lsNap", JSON.stringify(lsNap));
}
function pushRut(obj){
  lsRut.push(obj);
  localStorage.setItem("lsRut", JSON.stringify(lsRut));
}

/* Transaction feed: start with some fake + load real from lsNap/lsRut */
const feedBox = document.getElementById("gdList");
const fakeFeed = [
  "Nguy·ªÖn H·ªØu T. v·ª´a n·∫°p 100.000ƒë",
  "L√™ Minh K. r√∫t 340 Robux",
  "Tr·∫ßn Anh N. n·∫°p 50.000ƒë",
  "Ph·∫°m T·∫•n L. nh·∫≠n 120 Robux",
  "Ng√¥ Ph∆∞∆°ng D. n·∫°p 200.000ƒë",
  "Kh√°ch ·∫©n danh r√∫t 500 Robux",
  "Ho√†ng M·∫°nh H. n·∫°p 300.000ƒë",
];

function renderFeed(){
  const recentReal = [];
  // mix some recent lsNap/lsRut entries as "real"
  for(let i = lsNap.length-1;i>=0 && recentReal.length<6;i--){
    const e = lsNap[i];
    recentReal.push(`${e.user} n·∫°p ${e.amount ? e.amount.toLocaleString() + "ƒë" : ""} ${e.robux ? "(" + e.robux + " Robux)" : ""}`);
  }
  for(let i = lsRut.length-1;i>=0 && recentReal.length<12;i--){
    const e = lsRut[i];
    recentReal.push(`${e.user} r√∫t ${e.robux} Robux`);
  }
  // mix fake + real
  const mixed = [];
  const pool = [...fakeFeed, ...recentReal];
  for(let i=0;i<Math.min(12,pool.length);i++){
    mixed.push(pool[Math.floor(Math.random()*pool.length)]);
  }
  feedBox.innerHTML = mixed.map(t=>`<div class="gd-item">${t}</div>`).join('');
}
renderFeed();

// auto-scroll
let feedScroll = 0;
setInterval(()=>{
  const box = document.getElementById("gdList");
  if(!box) return;
  renderFeed();
  feedScroll += 1;
  box.scrollTo({top: feedScroll, behavior: 'smooth'});
  if(feedScroll > box.scrollHeight - box.clientHeight) feedScroll = 0;
}, 1500);

// helper to add single new display entry at top
function addTransactionDisplay(text){
  const box = document.getElementById("gdList");
  const el = document.createElement("div");
  el.className = "gd-item";
  el.innerText = text;
  box.prepend(el);
  // keep history
  setTimeout(()=>{ renderFeed(); }, 800);
}

/* ---------- L·ªäCH S·ª¨ HI·ªÇN TH·ªä TRONG TAB ---------- */
function updateNapLS(){
  const box = document.getElementById("lsNapBox");
  if(!box) return;
  const list = lsNap.filter(x => x.user === (currentUser.username || "guest")).reverse();
  if(list.length===0){
    box.innerHTML = `<div class="hist-box">B·∫°n ch∆∞a c√≥ l·ªãch s·ª≠ n·∫°p n√†o.</div>`;
    return;
  }
  box.innerHTML = list.map(x=>`
    <div class="hist-box">
      <b>+${x.robux}</b> Robux ${x.amount ? `(${x.amount.toLocaleString()}ƒë)` : ''}<br>
      <small>${x.time}${x.note ? ' ‚Ä¢ ' + x.note : ''}</small>
    </div>
  `).join('');
}

function updateRutLS(){
  const box = document.getElementById("lsRutBox");
  if(!box) return;
  const list = lsRut.filter(x => x.user === (currentUser.username || "guest")).reverse();
  if(list.length===0){
    box.innerHTML = `<div class="hist-box rut">B·∫°n ch∆∞a c√≥ l·ªãch s·ª≠ r√∫t n√†o.</div>`;
    return;
  }
  box.innerHTML = list.map(x=>`
    <div class="hist-box rut">
      <b>-${x.robux}</b> Robux ‚Üí ${x.to ? `<b>${x.to}</b>` : ''}<br>
      <small>${x.time}${x.note ? ' ‚Ä¢ ' + x.note : ''}</small>
    </div>
  `).join('');
}

/* ---------- R√öT: GHI L·ªäCH S·ª¨ + FEED ---------- */
document.getElementById("rutBtn").addEventListener("click", function(){
  const userRbx = document.getElementById("rbxUser").value.trim();
  const amt = parseInt(document.getElementById("rbxAmt").value);
  if(!userRbx || !amt || amt < 1) return alert("Nh·∫≠p ƒë√∫ng username Roblox + s·ªë Robux!");

  pushRut({
    user: currentUser.username || "guest",
    robux: amt,
    to: userRbx,
    time: new Date().toLocaleString()
  });
  addTransactionDisplay(`${currentUser.username || "guest"} r√∫t ${amt} Robux ‚Üí ${userRbx}`);
  updateRutLS();
  alert("Y√™u c·∫ßu ƒë√£ g·ª≠i! Admin donate trong 5-10 ph√∫t");
});

/* ---------- KH·ªûI T·∫†O HI·ªÇN TH·ªä CHO NG∆Ø·ªúI M·ªöI V√Ä LOAD REVIEWS ---------- */
document.addEventListener("DOMContentLoaded", ()=>{
  // set name if logged in demo
  document.getElementById("name").innerText = currentUser.username || "b·∫°n";
  document.getElementById("bal").innerText = currentUser.balance || 0;
  updateNapLS();
  updateRutLS();
  renderFeed();
});

const reviews = ["R√∫t 1 ph√∫t c√≥","N·∫°p th·∫ª c√†o t·ª± ƒë·ªông","Gi√° r·∫ª nh·∫•t VN","Admin donate nhanh","Shop ƒë·∫πp x·ªâu","24/7 c√≥ ng∆∞·ªùi duy·ªát!"];
reviews.forEach(t=>{
  const container = document.getElementById("reviews");
  if(container) container.innerHTML += `
    <div style="background:#f9f9f9;padding:20px;margin:16px 0;border-radius:18px;border-left:6px solid var(--gold);box-shadow:0 8px 25px rgba(0,0,0,0.1)">
      <div style="color:var(--gold);font-size:2rem">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
      <p style="margin:8px 0;font-weight:bold">Kh√°ch h√†ng ·∫©n danh</p>
      <p style="font-size:18px">${t}</p>
    </div>`;
});
</script>

</body>
</html>
